/*!
 * This file is part of Weaver.js 1.0.2.
 * 
 * Weaver.js is free software: you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as published by the Free
 * Software Foundation, either version 3 of the License, or (at your option) any
 * later version.
 * 
 * Weaver.js is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
 * details.
 * 
 * You should have received a copy of the GNU Lesser General Public License along with
 * Weaver.js. If not, see <http://www.gnu.org/licenses/>.
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.weaver=e()}}(function(){var define,module,exports;return function e(t,n,r){function i(s,o){if(!n[s]){if(!t[s]){var f="function"==typeof require&&require;if(!o&&f)return f(s,!0);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){"use strict";var r=e("./is"),i=e("./util"),a=e("./promise"),s=e("./event"),o={event:{regex:/(\w+)(\.\w+)?/,optionalTypeRegex:/(\w+)?(\.\w+)?/,falseCallback:function(){return!1}},on:function(e){var t={unbindSelfOnTrigger:!1,unbindAllBindersOnTrigger:!1};return e=i.extend({},t,e),function(t,n,i){var a=this,s=void 0!==a.length,f=s?a:[a],u=r.string(t),l=e;if((r.fn(n)||n===!1)&&(i=n,n=void 0),!r.fn(i)&&i!==!1&&u)return a;if(u){var c={};c[t]=i,t=c}for(var p in t)if(i=t[p],i===!1&&(i=o.event.falseCallback),r.fn(i)){p=p.split(/\s+/);for(var d=0;d<p.length;d++){var v=p[d];if(!r.emptyString(v)){var h=v.match(o.event.regex);if(h)for(var g=h[1],m=h[2]?h[2]:void 0,y={callback:i,data:n,type:g,namespace:m,unbindSelfOnTrigger:l.unbindSelfOnTrigger,unbindAllBindersOnTrigger:l.unbindAllBindersOnTrigger,binders:f},b=0;b<f.length;b++){var _=f[b]._private;_.listeners=_.listeners||[],_.listeners.push(y)}}}}return a}},eventAliasesOn:function(e){var t=e;t.addListener=t.listen=t.bind=t.on,t.removeListener=t.unlisten=t.unbind=t.off,t.emit=t.trigger,t.pon=t.promiseOn=function(e,t){var n=this,r=Array.prototype.slice.call(arguments,0);return new a(function(e,t){var i=function(t){n.off.apply(n,s),e(t)},a=r.concat([i]),s=a.concat([]);n.on.apply(n,a)})}},off:function(e){var t={};return e=i.extend({},t,e),function(e,t){var n=this,i=void 0!==n.length,a=i?n:[n],s=r.string(e);if(0===arguments.length){for(var f=0;f<a.length;f++)a[f]._private.listeners=[];return n}if(s){var u={};u[e]=t,e=u}for(var l in e){t=e[l],t===!1&&(t=o.event.falseCallback),l=l.split(/\s+/);for(var c=0;c<l.length;c++){var p=l[c];if(!r.emptyString(p)){var d=p.match(o.event.optionalTypeRegex);if(d)for(var v=d[1]?d[1]:void 0,h=d[2]?d[2]:void 0,f=0;f<a.length;f++)for(var g=a[f]._private.listeners=a[f]._private.listeners||[],m=0;m<g.length;m++){var y=g[m],b=!h||h===y.namespace,_=!v||y.type===v,w=!t||t===y.callback,j=b&&_&&w;j&&(g.splice(m,1),m--)}}}}return n}},trigger:function(e){var t={};return e=i.extend({},t,e),function(e,t,n){var i=this,a=void 0!==i.length,f=a?i:[i],u=r.string(e),l=r.plainObject(e),c=r.event(e);if(u){var p=e.split(/\s+/);e=[];for(var d=0;d<p.length;d++){var v=p[d];if(!r.emptyString(v)){var h=v.match(o.event.regex),g=h[1],m=h[2]?h[2]:void 0;e.push({type:g,namespace:m})}}}else if(l){var y=e;e=[y]}t?r.array(t)||(t=[t]):t=[];for(var d=0;d<e.length;d++)for(var b=e[d],_=0;_<f.length;_++){var v,w=f[_],j=w._private.listeners=w._private.listeners||[],S=!1;v=c?b:new s(b,{namespace:b.namespace}),n&&(j=[{namespace:v.namespace,type:v.type,callback:n}]);for(var $=0;$<j.length;$++){var x=j[$],q=!x.namespace||x.namespace===v.namespace,O=x.type===v.type,T=!0,A=q&&O&&T;if(A){var P=[v];if(P=P.concat(t),x.data?v.data=x.data:v.data=void 0,(x.unbindSelfOnTrigger||x.unbindAllBindersOnTrigger)&&(j.splice($,1),$--),x.unbindAllBindersOnTrigger)for(var R=x.binders,k=0;k<R.length;k++){var E=R[k];if(E&&E!==w)for(var F=E._private.listeners,M=0;M<F.length;M++){var L=F[M];L===x&&(F.splice(M,1),M--)}}var N=w,D=x.callback.apply(N,P);(D===!1||v.isPropagationStopped())&&(S=!1,D===!1&&(v.stopPropagation(),v.preventDefault()))}}}return i}}};t.exports=o},{"./event":2,"./is":5,"./promise":6,"./util":8}],2:[function(e,t,n){"use strict";function r(){return!1}function i(){return!0}var a=function(e,t){return this instanceof a?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented?i:r):this.type=e,t&&(this.type=void 0!==t.type?t.type:this.type,this.namespace=t.namespace,this.layout=t.layout,this.data=t.data,this.message=t.message),void(this.timeStamp=e&&e.timeStamp||+new Date)):new a(e,t)};a.prototype={instanceString:function(){return"event"},preventDefault:function(){this.isDefaultPrevented=i;var e=this.originalEvent;e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){this.isPropagationStopped=i;var e=this.originalEvent;e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=i,this.stopPropagation()},isDefaultPrevented:r,isPropagationStopped:r,isImmediatePropagationStopped:r},t.exports=a},{}],3:[function(e,t,n){"use strict";var r=e("./is"),i=e("./util"),a=e("./thread"),s=e("./promise"),o=e("./define"),f=function(t){if(!(this instanceof f))return new f(t);this._private={pass:[]};var n=4;if(r.number(t),"undefined"!=typeof navigator&&null!=navigator.hardwareConcurrency)t=navigator.hardwareConcurrency;else try{t=e("os").cpus().length}catch(i){t=n}for(var s=0;t>s;s++)this[s]=new a;this.length=t},u=f.prototype;i.extend(u,{instanceString:function(){return"fabric"},require:function(e,t){for(var n=0;n<this.length;n++){var r=this[n];r.require(e,t)}return this},random:function(){var e=Math.round((this.length-1)*Math.random()),t=this[e];return t},run:function(e){var t=this._private.pass.shift();return this.random().pass(t).run(e)},message:function(e){return this.random().message(e)},broadcast:function(e){for(var t=0;t<this.length;t++){var n=this[t];n.message(e)}return this},stop:function(){for(var e=0;e<this.length;e++){var t=this[e];t.stop()}return this},pass:function(e){var t=this._private.pass;return r.array(e)?t.push(e):i.error("Only arrays or collections may be used with fabric.pass()"),this},spreadSize:function(){var e=Math.ceil(this._private.pass[0].length/this.length);return e=Math.max(1,e)},spread:function(e){for(var t=this,n=t._private,r=t.spreadSize(),i=n.pass.shift().concat([]),a=[],o=0;o<this.length;o++){var f=this[o],u=i.splice(0,r),l=f.pass(u).run(e);a.push(l);var c=0===i.length;if(c)break}return s.all(a).then(function(e){for(var t=[],n=0,r=0;r<e.length;r++)for(var i=e[r],a=0;a<i.length;a++){var s=i[a];t[n++]=s}return t})},map:function(e){var t=this;return t.require(e,"_$_$_fabmap"),t.spread(function(e){var t=[],n=resolve;resolve=function(e){t.push(e)};for(var r=0;r<e.length;r++){var i=t.length,a=_$_$_fabmap(e[r]),s=i===t.length;s&&t.push(a)}return resolve=n,t})},filter:function(e){var t=this._private,n=t.pass[0];return this.map(e).then(function(e){for(var t=[],r=0;r<n.length;r++){var i=n[r],a=e[r];a&&t.push(i)}return t})},sort:function(e){var t=this,n=this._private.pass[0].length,r=this.spreadSize();return e=e||function(e,t){return t>e?-1:e>t?1:0},t.require(e,"_$_$_cmp"),t.spread(function(e){var t=e.sort(_$_$_cmp);resolve(t)}).then(function(t){for(var i=function(r,i,a){i=Math.min(i,n),a=Math.min(a,n);for(var s=r,o=i,f=[],u=s;a>u;u++){var l=t[r],c=t[i];o>r&&(i>=a||e(l,c)<=0)?(f.push(l),r++):(f.push(c),i++)}for(var u=0;u<f.length;u++){var p=s+u;t[p]=f[u]}},a=r;n>a;a*=2)for(var s=0;n>s;s+=2*a)i(s,s+a,s+2*a);return t})}});var l=function(e){return e=e||{},function(t,n){var r=this._private.pass.shift();return this.random().pass(r)[e.threadFn](t,n)}};i.extend(u,{randomMap:l({threadFn:"map"}),reduce:l({threadFn:"reduce"}),reduceRight:l({threadFn:"reduceRight"})});var c=u;c.promise=c.run,c.terminate=c.halt=c.stop,c.include=c.require,i.extend(u,{on:o.on(),one:o.on({unbindSelfOnTrigger:!0}),off:o.off(),trigger:o.trigger()}),o.eventAliasesOn(u),t.exports=f},{"./define":1,"./is":5,"./promise":6,"./thread":7,"./util":8,os:void 0}],4:[function(e,t,n){"use strict";var r=e("./thread"),i=e("./fabric"),a=function(){};a.version="1.0.2",a.thread=a.Thread=a.worker=a.Worker=r,a.fabric=a.Fabric=i,t.exports=a},{"./fabric":3,"./thread":7}],5:[function(e,t,n){"use strict";var r="string",i=typeof{},a="function",s=function(e){return e&&e.instanceString&&o.fn(e.instanceString)?e.instanceString():null},o={defined:function(e){return null!=e},string:function(e){return null!=e&&typeof e==r},fn:function(e){return null!=e&&typeof e===a},array:function(e){return Array.isArray?Array.isArray(e):null!=e&&e instanceof Array},plainObject:function(e){return null!=e&&typeof e===i&&!o.array(e)&&e.constructor===Object},object:function(e){return null!=e&&typeof e===i},number:function(e){return null!=e&&"number"==typeof e&&!isNaN(e)},integer:function(e){return o.number(e)&&Math.floor(e)===e},bool:function(e){return null!=e&&typeof e==typeof!0},event:function(e){return"event"===s(e)},thread:function(e){return"thread"===s(e)},fabric:function(e){return"fabric"===s(e)},emptyString:function(e){return e?o.string(e)&&(""===e||e.match(/^\s+$/))?!0:!1:!0},nonemptyString:function(e){return e&&o.string(e)&&""!==e&&!e.match(/^\s+$/)?!0:!1}};t.exports=o},{}],6:[function(e,t,n){"use strict";var r=0,i=1,a=2,s=function(e){return this instanceof s?(this.id="Thenable/1.0.7",this.state=r,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],this.proxy={then:this.then.bind(this)},void("function"==typeof e&&e.call(this,this.fulfill.bind(this),this.reject.bind(this)))):new s(e)};s.prototype={fulfill:function(e){return o(this,i,"fulfillValue",e)},reject:function(e){return o(this,a,"rejectReason",e)},then:function(e,t){var n=this,r=new s;return n.onFulfilled.push(l(e,r,"fulfill")),n.onRejected.push(l(t,r,"reject")),f(n),r.proxy}};var o=function(e,t,n,i){return e.state===r&&(e.state=t,e[n]=i,f(e)),e},f=function(e){e.state===i?u(e,"onFulfilled",e.fulfillValue):e.state===a&&u(e,"onRejected",e.rejectReason)},u=function(e,t,n){if(0!==e[t].length){var r=e[t];e[t]=[];var i=function(){for(var e=0;e<r.length;e++)r[e](n)};"function"==typeof setImmediate?setImmediate(i):setTimeout(i,0)}},l=function(e,t,n){return function(r){if("function"!=typeof e)t[n].call(t,r);else{var i;try{i=e(r)}catch(a){return void t.reject(a)}c(t,i)}}},c=function(e,t){if(e===t||e.proxy===t)return void e.reject(new TypeError("cannot resolve promise with itself"));var n;if("object"==typeof t&&null!==t||"function"==typeof t)try{n=t.then}catch(r){return void e.reject(r)}if("function"!=typeof n)e.fulfill(t);else{var i=!1;try{n.call(t,function(n){i||(i=!0,n===t?e.reject(new TypeError("circular thenable chain")):c(e,n))},function(t){i||(i=!0,e.reject(t))})}catch(r){i||e.reject(r)}}},p="undefined"==typeof p?s:p;p.all=p.all||function(e){return new p(function(t,n){for(var r=new Array(e.length),i=0,a=function(n,a){r[n]=a,i++,i===e.length&&t(r)},s=0;s<e.length;s++)!function(t){var r=e[t],i=null!=r.then;if(i)r.then(function(e){a(t,e)},function(e){n(e)});else{var s=r;a(t,s)}}(s)})},t.exports=p},{}],7:[function(_dereq_,module,exports){"use strict";var window=_dereq_("./window"),util=_dereq_("./util"),Promise=_dereq_("./promise"),Event=_dereq_("./event"),define=_dereq_("./define"),is=_dereq_("./is"),Thread=function(e){if(!(this instanceof Thread))return new Thread(e);var t=this._private={requires:[],files:[],queue:null,pass:[],disabled:!1};is.plainObject(e)&&null!=e.disabled&&(t.disabled=!!e.disabled)},thdfn=Thread.prototype,stringifyFieldVal=function(e){var t=is.fn(e)?e.toString():'JSON.parse("'+JSON.stringify(e)+'")';return t},fnAsRequire=function(e){var t,n;is.object(e)&&e.fn?(t=fnAs(e.fn,e.name),n=e.name,e=e.fn):is.fn(e)?(t=e.toString(),n=e.name):is.string(e)?t=e:is.object(e)&&(t=e.proto?"":e.name+" = {};",n=e.name,e=e.obj),t+="\n";var r=function(e,n){if(e.prototype){var r=!1;for(var i in e.prototype){r=!0;break}r&&(t+=fnAsRequire({name:n,obj:e,proto:!0},e))}};if(e.prototype&&null!=n)for(var i in e.prototype){var a="",s=e.prototype[i],o=stringifyFieldVal(s),f=n+".prototype."+i;a+=f+" = "+o+";\n",a&&(t+=a),r(s,f)}if(!is.string(e))for(var i in e){var u="";if(e.hasOwnProperty(i)){var s=e[i],o=stringifyFieldVal(s),f=n+'["'+i+'"]';u+=f+" = "+o+";\n"}u&&(t+=u),r(s,f)}return t},isPathStr=function(e){return is.string(e)&&e.match(/\.js$/)};util.extend(thdfn,{instanceString:function(){return"thread"},require:function(e,t){return isPathStr(e)?(this._private.files.push(e),this):(t&&(is.fn(e)?(t=t||e.name,e={name:t,fn:e}):e={name:t,obj:e}),this._private.requires.push(e),this)},pass:function(e){return this._private.pass.push(e),this},run:function(fn,pass){var self=this,_p=this._private;if(pass=pass||_p.pass.shift(),_p.stopped)return void util.error("Attempted to run a stopped thread!  Start a new thread or do not stop the existing thread and reuse it.");if(_p.running)return _p.queue=_p.queue.then(function(){return self.run(fn,pass)});var useWW=null!=window&&!_p.disabled,useNode=!window&&"undefined"!=typeof module&&!_p.disabled;self.trigger("run");var runP=new Promise(function(resolve,reject){_p.running=!0;var threadTechAlreadyExists=_p.ran,fnImplStr=is.string(fn)?fn:fn.toString(),fnStr="\n"+_p.requires.map(function(e){return fnAsRequire(e)}).concat(_p.files.map(function(e){if(useWW){var t=function(e){return e.match(/^\.\//)||e.match(/^\.\./)?window.location.origin+window.location.pathname+e:e.match(/^\//)?window.location.origin+"/"+e:e};return'importScripts("'+t(e)+'");'}if(useNode)return'eval( require("fs").readFileSync("'+e+'", { encoding: "utf8" }) );';throw"External file `"+e+"` can not be required without any threading technology."})).concat(["( function(){","var ret = ("+fnImplStr+")("+JSON.stringify(pass)+");","if( ret !== undefined ){ resolve(ret); }","} )()\n"]).join("\n");if(_p.requires=[],_p.files=[],useWW){var fnBlob,fnUrl;if(!threadTechAlreadyExists){var fnPre=fnStr+"";fnStr=["function broadcast(m){ return message(m); };","function message(m){ postMessage(m); };","function listen(fn){",'  self.addEventListener("message", function(m){ ','    if( typeof m === "object" && (m.data.$$eval || m.data === "$$start") ){',"    } else { ","      fn( m.data );","    }","  });","};",'self.addEventListener("message", function(m){  if( m.data.$$eval ){ eval( m.data.$$eval ); }  });',"function resolve(v){ postMessage({ $$resolve: v }); };","function reject(v){ postMessage({ $$reject: v }); };"].join("\n"),fnStr+=fnPre,fnBlob=new Blob([fnStr],{type:"application/javascript"}),fnUrl=window.URL.createObjectURL(fnBlob)}var ww=_p.webworker=_p.webworker||new Worker(fnUrl);threadTechAlreadyExists&&ww.postMessage({$$eval:fnStr});var cb;ww.addEventListener("message",cb=function(e){var t=is.object(e)&&is.object(e.data);t&&"$$resolve"in e.data?(ww.removeEventListener("message",cb),resolve(e.data.$$resolve)):t&&"$$reject"in e.data?(ww.removeEventListener("message",cb),reject(e.data.$$reject)):self.trigger(new Event(e,{type:"message",message:e.data}))},!1),threadTechAlreadyExists||ww.postMessage("$$start")}else if(useNode){_p.child||(_p.child=_dereq_("child_process").fork(_dereq_("path").join(__dirname,"thread-node-fork")));var child=_p.child,cb;child.on("message",cb=function(e){is.object(e)&&"$$resolve"in e?(child.removeListener("message",cb),resolve(e.$$resolve)):is.object(e)&&"$$reject"in e?(child.removeListener("message",cb),reject(e.$$reject)):self.trigger(new Event({},{type:"message",message:e}))}),child.send({$$eval:fnStr})}else{var promiseResolve=resolve,promiseReject=reject,timer=_p.timer=_p.timer||{listeners:[],exec:function(){function broadcast(e){return message(e)}function message(e){self.trigger(new Event({},{type:"message",message:e}))}function listen(e){timer.listeners.push(e)}function resolve(e){promiseResolve(e)}function reject(e){promiseReject(e)}eval(fnStr)},message:function(e){for(var t=timer.listeners,n=0;n<t.length;n++){var r=t[n];r(e)}}};timer.exec()}}).then(function(e){return _p.running=!1,_p.ran=!0,self.trigger("ran"),e});return null==_p.queue&&(_p.queue=runP),runP},message:function(e){var t=this._private;return t.webworker&&t.webworker.postMessage(e),t.child&&t.child.send(e),t.timer&&t.timer.message(e),this},stop:function(){var e=this._private;return e.webworker&&e.webworker.terminate(),e.child&&e.child.kill(),e.timer,e.stopped=!0,this.trigger("stop")},stopped:function(){return this._private.stopped}});var fnAs=function(e,t){var n=e.toString();return n=n.replace(/function.*\(/,"function "+t+"(")},defineFnal=function(e){return e=e||{},function(t,n){var r=fnAs(t,"_$_$_"+e.name);return this.require(r),this.run(["function( data ){","  var origResolve = resolve;","  var res = [];","  ","  resolve = function( val ){","    res.push( val );","  };","  ","  var ret = data."+e.name+"( _$_$_"+e.name+(arguments.length>1?", "+JSON.stringify(n):"")+" );","  ","  resolve = origResolve;","  resolve( res.length > 0 ? res : ret );","}"].join("\n"))}};util.extend(thdfn,{reduce:defineFnal({name:"reduce"}),reduceRight:defineFnal({name:"reduceRight"}),map:defineFnal({name:"map"})});var fn=thdfn;fn.promise=fn.run,fn.terminate=fn.halt=fn.stop,fn.include=fn.require,util.extend(thdfn,{on:define.on(),one:define.on({unbindSelfOnTrigger:!0}),off:define.off(),trigger:define.trigger()}),define.eventAliasesOn(thdfn),module.exports=Thread},{"./define":1,"./event":2,"./is":5,"./promise":6,"./util":8,"./window":9,child_process:void 0,path:void 0}],8:[function(e,t,n){"use strict";var r,i=e("./is");r={extend:function(){var e,t,n,a,s,o,f=arguments[0]||{},u=1,l=arguments.length,c=!1;for("boolean"==typeof f&&(c=f,f=arguments[1]||{},u=2),"object"==typeof f||i.fn(f)||(f={}),l===u&&(f=this,--u);l>u;u++)if(null!=(e=arguments[u]))for(t in e)n=f[t],a=e[t],f!==a&&(c&&a&&(i.plainObject(a)||(s=i.array(a)))?(s?(s=!1,o=n&&i.array(n)?n:[]):o=n&&i.plainObject(n)?n:{},f[t]=r.extend(c,o,a)):void 0!==a&&(f[t]=a));return f},error:function(e){if(!console)throw e;if(console.error)console.error.apply(console,arguments);else{if(!console.log)throw e;console.log.apply(console,arguments)}}},t.exports=r},{"./is":5}],9:[function(e,t,n){t.exports="undefined"==typeof window?null:window},{}]},{},[4])(4)});
//# sourceMappingURL=weaver.min.js.map